# TCP/IP Illustration

## chapter 2

### 2.3 尾部封装

RFC 893[Leffler and Karels 1984]描述了另一种用于以太网的封装格式，称作尾部封装（trailer encapsulation）

它通过调整I P数据报中字段的次序来提高性能。
在以太网数据帧中，开始的那部分是变长的字段（I P首部和T C P首部）。把它们移到尾部（在 C R C之前），这样当把数据复制到内核时，就可以把数据帧中的数据部分映射到一个硬件页面，节省内存到内存的复制过程。
T C P数据报的长度是5 1 2字节的整数倍，正好可以用内核中的页表来处理。

4.3 ARP高速缓存A R P高效运行的关键是由于每个主机上都有一个 A R P高速缓存。这个高速缓存存放了最近I n t e r n e t地址到硬件地址之间的映射记录。高速缓存中每一项的生存时间一般为 2 0分钟，起始时间从被创建时开始算

程序打印出I C M P报文中的三个时间戳：发起时间戳（ o r i g）、接收时间戳（ r e c v）以及发送时间戳（ x m i t）。正如我们在这个例子以及下面的例子中所看到的那样，所有的主机把接收时间戳和发送时间戳都设成相同的值。我们还能计算出往返时间（r t t），它的值是收到应答时的时间值减去发送请求时的时间值。d i f f e r e n c e的值是接收时间戳值减去发起时间戳值。这些值之间的关系如图6 - 7所示。图6-7 i c m p t i m e 程序输出的值之间的关系如果我们相信RT T的值，并且相信RT T的一半用于请求报文的传输，另一半用于应答报文的传输，那么为了使本机时钟与查询主机的时钟一致，本机时钟需要进行调整，调整值是d i f f e r e n c e减去RT T的一半。在前面的例子中， b s d i的时钟比s u n的时钟要慢7 ms和8 ms。发起 请求接收 传送

a--t1--d1
d2--t2--b
x 为两端时差
$$ a=d1-t1+x $$
$$ t2=b-d2-x $$
假设 t1 == t2 则
$$ d1-a+x == b-d2-x $$
$$ x = (b-d2)/2 + (a-d1)/2 $$

严格的计时器使用网络时间协议（ N T P），该协议在 RFC 1305中给出了描述 [ M i l l s
1 9 9 2 ]。这个协议采用先进的技术来保证 L A N或WA N上的一组系统的时钟误差在毫秒
级以内。对计算机精确时间感兴趣的读者应该阅读这份 R F C文档。
3) 开放软件基金会（ O S F）的分布式计算环境（ D C E）定义了分布式时间服务（ D T S），
第6章 ICMP：Internet控制报文协议使用55 下载
前三行是Telnet客户的输出
这是日期时间服务器的输出
这也是Telnet客户的输出
它也提供计算机之间的时钟同步。文献 [ R o s e n b e rg, Kenney and Fisher 1992]提供了该服
务的其他细节描述。
4) 伯克利大学的 U n i x系统提供守护程序 t i m e d( 8 )，来同步局域网上的系统时钟。不像
N T P和D T S，t i m e d不在广域网范围内工作